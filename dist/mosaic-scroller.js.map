{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap c9b24f401d9a827e0601","webpack:///./index.js","webpack:///./src/ItemsList.js","webpack:///./src/Range.js","webpack:///./src/Scroller.js","webpack:///./src/ScrollerView.js","webpack:///external \"underscore\"","webpack:///external \"mosaic-commons\"","webpack:///external \"react\""],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,wC;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACLA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA,MAAK;;AAEL,EAAC;;;;;;;AC7CD;AACA;;AAEA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA,UAAS;AACT;;AAEA,EAAC;;;;;;;ACtDD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,cAAa;AACb;AACA;AACA,cAAa;AACb,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,UAAS;AACT,MAAK;;AAEL,EAAC;;;;;;;ACxKD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gCAA+B;AAC/B;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA,2BAA0B;AAC1B,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL,EAAC;;;;;;;ACjFD,gD;;;;;;ACAA,gD;;;;;;ACAA,gD","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"underscore\"), require(\"mosaic-commons\"), require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"underscore\", \"mosaic-commons\", \"react\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"mosaic-scroller\"] = factory(require(\"underscore\"), require(\"mosaic-commons\"), require(\"react\"));\n\telse\n\t\troot[\"mosaic-scroller\"] = factory(root[\"underscore\"], root[\"mosaic-commons\"], root[\"react\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c9b24f401d9a827e0601\n **/","module.exports = {\n    ItemsList : require('./src/ItemsList'),\n    Range : require('./src/Range'),\n    Scroller : require('./src/Scroller'),\n    ScrollerView : require('./src/ScrollerView')\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./index.js\n ** module id = 0\n ** module chunks = 0\n **/","var _ = require('underscore');\nvar Mosaic = require('mosaic-commons');\nvar Range = require('./Range');\n\nmodule.exports = Range.extend({\n\n    /** Returns the length of this block. */\n    getLength : function() {\n        var len = 0;\n        var items = this.getItems();\n        _.each(items, function(item) {\n            len += item.getLength();\n        });\n        return len;\n    },\n\n    /**\n     * Returns the number of items in the block.\n     */\n    getItemsNumber : function() {\n        var items = this.getItems();\n        return items.length;\n    },\n\n    /** Returns all items in this block. */\n    getItems : function() {\n        return this._get('itms') || [];\n    },\n\n    /** Returns the start index of the first list item. */\n    getStartIndex : function() {\n        return this._get('idx') || 0;\n    },\n\n    getEndIndex : function() {\n        var from = this.getStartIndex();\n        var items = this.getItems();\n        return from + items.length;\n    },\n\n    /** Sets a new array of items in the block. */\n    setItems : function(items) {\n        return this._set('itms', items || []);\n    },\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/ItemsList.js\n ** module id = 1\n ** module chunks = 0\n **/","var _ = require('underscore');\nvar Mosaic = require('mosaic-commons');\n\nmodule.exports = Mosaic.Class.extend(Mosaic.Events.prototype, {\n\n    initialize : function(options) {\n        this.setOptions(options);\n    },\n    _setAll : function(obj) {\n        var updated = false;\n        _.each(obj, function(value, key) {\n            updated |= !this._equal(value, this.options[key]);\n            this.options[key] = value;\n        }, this);\n        return this._notify(updated);\n    },\n    _set : function(key, value) {\n        var updated = !this._equal(value, this.options[key]);\n        this.options[key] = value;\n        return this._notify(updated);\n    },\n    _get : function(key) {\n        return this.options[key];\n    },\n    _equal : function(first, second) {\n        return first == second;\n    },\n    _notify : function(updated) {\n        if (updated) {\n            this.fire('updated');\n        }\n        return updated;\n    },\n    setLength : function(value) {\n        return this._set('len', value || 0);\n    },\n\n    getLength : function(value) {\n        return this._get('len');\n    },\n\n    setPosition : function(value) {\n        return this._set('pos', value || 0);\n    },\n    getPosition : function(value) {\n        return this._get('pos');\n    },\n    setPositionAndLength : function(pos, len) {\n        return this._setAll({\n            'pos' : pos,\n            'len' : len\n        });\n    }\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/Range.js\n ** module id = 2\n ** module chunks = 0\n **/","var _ = require('underscore');\nvar Mosaic = require('mosaic-commons');\nvar Range = require('./Range');\nvar ItemsList = require('./ItemsList');\n\nmodule.exports = Mosaic.Class.extend(Mosaic.Events.prototype, {\n    initialize : function(options) {\n        this.setOptions(options);\n        this.list = new ItemsList(options);\n        this.scroll = new Range(options);\n        this.placeholder = new Range(options);\n    },\n\n    getLength : function() {\n        return this.placeholder.getLength();\n    },\n\n    setScroll : function(scrollPos, scrollLen) {\n        var that = this;\n        return that._handle(function(len) {\n            var fullScrollerLen = that._getFullScrollerLen(len);\n            var progress = scrollPos / fullScrollerLen;\n            progress = Math.max(0.0, Math.min(1.0, progress));\n            return that._updateScrollPosition(len, progress, scrollLen);\n        });\n    },\n\n    focusItem : function(index, scrollLen) {\n        var that = this;\n        return that._handle(function(len) {\n            index = index || 0;\n            var progress = len ? index / len : 0;\n            progress = Math.max(0.0, Math.min(1.0, progress));\n            return that._updateScrollPosition(len, progress, scrollLen);\n        });\n    },\n\n    _updateScrollPosition : function(len, progress, scrollLen) {\n        var that = this;\n        var listProgress = 0;\n        var listIndex = 0;\n        var fullScrollerLen = that._getFullScrollerLen(len);\n        var scrollPos = Math.round(fullScrollerLen * progress);\n        return Mosaic.P.then(function() {\n            that.placeholder.setLength(fullScrollerLen + scrollLen);\n            that.scroll.setPositionAndLength(scrollPos, scrollLen);\n\n            var itemId = Math.floor(progress * len);\n            itemId = Math.max(0, Math.min(len - 1, itemId));\n\n            var blockSize = that._getBlockSize(len);\n            var startIdx = Math.floor(itemId / blockSize) * blockSize;\n\n            var itemLen = that._getAverageItemLength();\n            var endIdx = Math.ceil((itemId + scrollLen / itemLen) / //\n            blockSize) * blockSize;\n\n            listIndex = startIdx;\n            var listSize = endIdx - startIdx;\n            listProgress = (progress * len - startIdx) / listSize;\n            return that._loadItems(listIndex, listSize);\n        }).then(function(items) {\n            that.list.setItems(items);\n            var listLength = that.list.getLength();\n            var updated;\n            if (listIndex == 0 && items.length >= len && //\n            listLength < scrollLen) {\n                that.placeholder.setLength(scrollLen);\n                that.scroll.setPositionAndLength(0, scrollLen);\n                updated = that.list.setPositionAndLength(0, 0);\n            } else {\n                var listShift = listProgress * listLength;\n                var listPos = Math.round(scrollPos - listShift);\n                updated = that.list.setPositionAndLength(listPos, listIndex);\n            }\n            if (updated) {\n                that.fire('updated');\n            }\n        });\n    },\n\n    _getFullScrollerLen : function(len) {\n        var size = 0;\n        if (len > 0) {\n            var n = Math.ceil(Math.log(len) / Math.log(10));\n            var itemLen = this._getAverageItemLength();\n            size = itemLen * Math.pow(10, n);\n        }\n        return size;\n    },\n\n    /**\n     * Returns a block size - a minimal number of items to load at once.\n     */\n    _getBlockSize : function(len) {\n        return this.options.blockSize || 5;\n    },\n\n    /**\n     * Returns an average item length. This length is used to estimate the\n     * number of items to load.\n     */\n    _getAverageItemLength : function() {\n        return this._itemLen || this.options.itemLen || 10;\n    },\n\n    /**\n     * Sets a new average item length. This length is used to estimate the\n     * number of items to load.\n     */\n    _setAverageItemLength : function(len) {\n        this._itemLen = len || 10;\n    },\n\n    _handle : function(action) {\n        var that = this;\n        return Mosaic.P.then(function() {\n            if (that._handling) {\n                return;\n            }\n            that._handling = true;\n            return that._load('__loadlength', function() {\n                var len = that.options.getItemsNumber;\n                if (_.isFunction(len)) {\n                    len = len();\n                }\n                return len;\n            }).then(action).then(function(result) {\n                that._handling = false;\n                return result;\n            }, function(err) {\n                that._handling = false;\n                throw err;\n            });\n        });\n    },\n\n    /**\n     * Loads items using the \"load\" method specified in the class options and\n     * returns a promise with results.\n     */\n    _loadItems : function(idx, len) {\n        return this._load('__loadItems', function() {\n            return this.options.loadItems({\n                index : idx,\n                length : len\n            });\n        });\n    },\n\n    _load : function(key, action) {\n        var that = this;\n        if (that[key]) {\n            that[key].reject('Interrupted');\n        }\n        var deferred = that[key] = Mosaic.P.defer();\n        Mosaic.P.then(function() {\n            return action.apply(that);\n        }).then(deferred.resolve, deferred.reject);\n        return deferred.promise.then(function(result) {\n            delete that[key];\n            return result;\n        }, function(err) {\n            delete that[key];\n            throw err;\n        });\n    },\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/Scroller.js\n ** module id = 3\n ** module chunks = 0\n **/","var _ = require('underscore');\nvar React = require('react');\nvar Scroller = require('./Scroller');\n\nmodule.exports = React.createClass({\n    getInitialState : function() {\n        this.manager = new Scroller(this.props);\n        this.manager.on('updated', this._onUpdate, this);\n        return this._newState();\n    },\n    componentDidMount : function(nextProps) {\n        this._updateScrollPos();\n    },\n    componentDidUpdate : function(nextProps) {\n        this._updateScrollPos();\n    },\n    render : function() {\n        var scroll = this.manager.scroll;\n        var list = this.manager.list;\n        var scrollPos = scroll.getPosition();\n        var scrollLen = scroll.getLength();\n        var listPos = list.getPosition();\n        var listLen = list.getLength();\n\n        var items = this._renderItems();\n        var placeholder = this.manager.placeholder;\n        var style = _.extend({}, this.props.style, {\n            overflowY : 'auto',\n            overflowX : 'hidden'\n        });\n        return React.DOM.div({\n            id : this.props.id,\n            className : this.props.className,\n            style : style,\n            onScroll : this._onScroll\n        }, React.DOM.div({\n            style : {\n                position : 'relative',\n                height : placeholder.getLength() + 'px'\n            }\n        }, React.DOM.div({\n            style : {\n                position : 'absolute',\n                height : list.getLength() + 'px',\n                top : list.getPosition() + 'px',\n                left : '0px',\n                right : '0px',\n                bottom : 'auto'\n            }\n        }, items)));\n    },\n    _onUpdate : function() {\n        this.setState(this._newState());\n    },\n    _newState : function(options) {\n        return _.extend({}, this.state, options);\n    },\n    _renderItems : function() {\n        var list = this.manager.list;\n        var items = list.getItems();\n        return this.props.renderItems({\n            items : items,\n            index : list.getStartIndex(),\n            position : list.getPosition(),\n            length : list.getLength()\n        });\n    },\n    /** This handler is called when the scroller changes its position. */\n    _onScroll : function(event) {\n        var container = this.getDOMNode();\n        var scrollPos = container.scrollTop;\n        var height = container.offsetHeight;\n        this.manager.setScroll(scrollPos, height);\n    },\n    _updateScrollPos : function() {\n        var container = this.getDOMNode();\n        var height = container.offsetHeight;\n        var index = this.props.index || 0;\n        this.manager.focusItem(index, height);\n    },\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/ScrollerView.js\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"underscore\"\n ** module id = 5\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mosaic-commons\"\n ** module id = 6\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_7__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"react\"\n ** module id = 7\n ** module chunks = 0\n **/"],"sourceRoot":"","file":"mosaic-scroller.js"}