{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 337e6bf827fc85e489e2","webpack:///./index.js","webpack:///./src/Scroller.js","webpack:///./src/ScrollerView.js","webpack:///external \"underscore\"","webpack:///external \"mosaic-commons\"","webpack:///external \"react\""],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,wC;;;;;;;ACtCA;AACA;AACA;AACA;;;;;;;ACHA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;;AAEL;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,cAAa;AACb;AACA;AACA,cAAa;AACb;AACA;AACA,MAAK;;AAEL,EAAC;;;;;;;ACtJD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA,4CAA2C;AAC3C;AACA;AACA,sBAAqB;AACrB;AACA;AACA,kBAAiB;AACjB,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA,MAAK;AACL;AACA;AACA;AACA,gCAA+B;AAC/B;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT,MAAK;AACL;AACA,2BAA0B;AAC1B,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAmC,sBAAsB;AACzD;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT,MAAK;;AAEL,EAAC;;;;;;;AClID,gD;;;;;;ACAA,gD;;;;;;ACAA,gD","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"underscore\"), require(\"mosaic-commons\"), require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"underscore\", \"mosaic-commons\", \"react\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"mosaic-scroller\"] = factory(require(\"underscore\"), require(\"mosaic-commons\"), require(\"react\"));\n\telse\n\t\troot[\"mosaic-scroller\"] = factory(root[\"underscore\"], root[\"mosaic-commons\"], root[\"react\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 337e6bf827fc85e489e2\n **/","module.exports = {\n    Scroller : require('./src/Scroller'),\n    ScrollerView : require('./src/ScrollerView')\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./index.js\n ** module id = 0\n ** module chunks = 0\n **/","var _ = require('underscore');\nvar Mosaic = require('mosaic-commons');\n\nmodule.exports = Mosaic.Class.extend(Mosaic.Events.prototype, {\n    initialize : function(options) {\n        this.setOptions(options);\n        this._scrollPosition = 0;\n        this._scrollLength = 0;\n        this._placeholderLength = 0;\n    },\n\n    getPlaceholderLength : function() {\n        return this._placeholderLength;\n    },\n\n    getScrollLength : function() {\n        return this._scrollLength;\n    },\n\n    setScrollLength : function(len) {\n        this._scrollLength = len || 1;\n    },\n\n    getScrollPosition : function() {\n        return this._scrollPosition;\n    },\n\n    updateScrollPosition : function(scrollPos) {\n        var that = this;\n        return that._handle(function(len) {\n            var fullScrollerLen = that._getFullScrollerLen(len);\n            var progress = scrollPos / fullScrollerLen;\n            progress = Math.max(0.0, Math.min(1.0, progress));\n            return that._updateScrollPosition(len, progress, -1);\n        });\n    },\n\n    scrollToItem : function(index) {\n        var that = this;\n        return that._handle(function(len) {\n            index = index || 0;\n            var progress = len ? index / len : 0;\n            progress = Math.max(0.0, Math.min(1.0, progress));\n            return that._updateScrollPosition(len, progress, index);\n        });\n    },\n\n    _updateScrollPosition : function(len, progress, focused) {\n        var that = this;\n        var listProgress = 0;\n        var listIndex = 0;\n        var fullScrollerLen = that._getFullScrollerLen(len);\n        var scrollPos = Math.round(fullScrollerLen * progress);\n        var scrollLen = that.getScrollLength();\n        return Mosaic.P.then(function() {\n            that._placeholderLength = fullScrollerLen + scrollLen;\n            that._scrollPosition = scrollPos;\n\n            var itemId = Math.floor(progress * len);\n            itemId = Math.max(0, Math.min(len - 1, itemId));\n\n            var blockSize = that._getBlockSize(len);\n            var startIdx = Math.floor(itemId / blockSize) * blockSize;\n\n            var itemLen = that._getAverageItemLength();\n            var endIdx = Math.ceil((itemId + scrollLen / itemLen) / //\n            blockSize) * blockSize;\n\n            listIndex = startIdx;\n            var listSize = endIdx - startIdx;\n            listProgress = (progress * len - startIdx) / listSize;\n            return that.options.renderItems({\n                index : listIndex,\n                length : listSize,\n                focused : focused\n            });\n        }).then(function(info) {\n            var listLength = info.length;\n            var size = info.size;\n            var itemsPosition = 0;\n            if (listIndex == 0 && size >= len && listLength < scrollLen) {\n                that._placeholderLength = scrollLen;\n                that._scrollPosition = 0;\n            } else {\n                var listShift = info.shift;\n                if (listShift === undefined || listShift < 0) {\n                    listShift = listProgress * listLength;\n                }\n                itemsPosition = Math.round(scrollPos - listShift);\n            }\n            return that.options.updateItemsPosition({\n                index : listIndex,\n                position : itemsPosition\n            });\n        });\n    },\n\n    _getFullScrollerLen : function(len) {\n        var size = 0;\n        if (len > 0) {\n            var n = Math.ceil(Math.log(len) / Math.log(10));\n            var itemLen = this._getAverageItemLength();\n            size = itemLen * Math.pow(10, n);\n        }\n        return size;\n    },\n\n    /**\n     * Returns a block size - a minimal number of items to load at once.\n     */\n    _getBlockSize : function(len) {\n        return this.options.blockSize || 5;\n    },\n\n    /**\n     * Returns an average item length. This length is used to estimate the\n     * number of items to load.\n     */\n    _getAverageItemLength : function() {\n        return this._itemLen || this.options.itemLen || 10;\n    },\n\n    /**\n     * Sets a new average item length. This length is used to estimate the\n     * number of items to load.\n     */\n    _setAverageItemLength : function(len) {\n        this._itemLen = len || 10;\n    },\n\n    _handle : function(action) {\n        var that = this;\n        if (!that._handling) {\n            that._handling = Mosaic.P.then(function() {\n                var len = that.options.getItemsNumber;\n                if (_.isFunction(len)) {\n                    len = len();\n                }\n                return len;\n            }).then(action).then(function(result) {\n                delete that._handling;\n                return result;\n            }, function(err) {\n                delete that._handling;\n                throw err;\n            });\n        }\n        return that._handling;\n    },\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/Scroller.js\n ** module id = 1\n ** module chunks = 0\n **/","var _ = require('underscore');\nvar React = require('react');\nvar Scroller = require('./Scroller');\nvar Mosaic = require('mosaic-commons');\n\nmodule.exports = React.createClass({\n    getInitialState : function() {\n        var that = this;\n        this.manager = new Scroller({\n            getItemsNumber : this.props.getItemsNumber,\n            renderItems : function(options) {\n                return Mosaic.P.then(function() {\n                    return that.props.renderItems(options);\n                }).then(function(items) {\n                    var deferred = Mosaic.P.defer();\n                    options.deferred = deferred;\n                    var index = options.index;\n                    var length = options.length;\n                    var state = _.extend({}, options, {\n                        items : items,\n                        deferred : deferred\n                    });\n                    that.setState(that._newState(state));\n                    return deferred.promise;\n                });\n            },\n            updateItemsPosition : function(options) {\n                var itemsBlock = that.refs.items;\n                var div = itemsBlock.getDOMNode();\n                var position = options.position;\n                div.style.top = position + 'px';\n            }\n        });\n        return this._newState({\n            items : [],\n            index : 0,\n            length : 0,\n            deferred : undefined\n        });\n    },\n    componentDidMount : function(nextProps) {\n        this._finishRendering();\n    },\n    componentDidUpdate : function(nextProps) {\n        this._finishRendering();\n    },\n    render : function() {\n        var items = this.state.items;\n        var placeholderLength = this.manager.getPlaceholderLength();\n        var style = _.extend({}, this.props.style, {\n            overflowY : 'auto',\n            overflowX : 'hidden'\n        });\n        return React.DOM.div({\n            id : this.props.id,\n            className : this.props.className,\n            style : style,\n            onScroll : this._onScroll\n        }, React.DOM.div({\n            style : {\n                position : 'relative',\n                height : placeholderLength + 'px'\n            }\n        }, React.DOM.div({\n            ref : 'items',\n            style : {\n                position : 'absolute',\n                left : '0px',\n                right : '0px',\n                bottom : 'auto'\n            }\n        }, items)));\n    },\n    _newState : function(options) {\n        return _.extend({}, this.state, options);\n    },\n    /** This handler is called when the scroller changes its position. */\n    _onScroll : function(event) {\n        if (this._handling)\n            return;\n        var container = this.getDOMNode();\n        var scrollPos = container.scrollTop;\n        this.manager.updateScrollPosition(scrollPos);\n    },\n    _finishRendering : function() {\n        var container = this.getDOMNode();\n        var height = container.offsetHeight;\n        this.manager.setScrollLength(height);\n\n        var deferred = this.state.deferred;\n        if (deferred) {\n            var itemsBlock = this.refs.items;\n            var div = itemsBlock.getDOMNode();\n            var length = div.offsetHeight;\n\n            var shift = -1;\n            var index = this.state.index;\n            var focused = this.state.focused;\n            if (focused >= 0) {\n                var child = div.firstChild;\n                shift = -1;\n                for (var i = index; child && i < focused; i++) {\n                    var len = child.offsetHeight;\n                    if (shift < 0) {\n                        shift = len;\n                    } else {\n                        shift += len;\n                    }\n                    child = child.nextSibling;\n                }\n            }\n            var result = {\n                length : length,\n                size : this.state.items.length,\n                shift : shift\n            };\n            var scrollPos = this.manager.getScrollPosition();\n            container.scrollTop = scrollPos;\n            deferred.resolve(result);\n        }\n        var index = this.props.index || 0;\n        var that = this;\n        that._handling = true;\n        this.manager.scrollToItem(index).then(function() {\n            setTimeout(function() {\n                that._handling = false;\n            }, 10);\n        });\n    },\n\n});\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/ScrollerView.js\n ** module id = 2\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_3__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"underscore\"\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mosaic-commons\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"react\"\n ** module id = 5\n ** module chunks = 0\n **/"],"sourceRoot":"","file":"mosaic-scroller.js"}