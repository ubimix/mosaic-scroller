/* 
 * mosaic-scroller v0.0.8 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("underscore"),require("mosaic-commons"),require("react")):"function"==typeof define&&define.amd?define(["underscore","mosaic-commons","react"],b):"object"==typeof exports?exports["mosaic-scroller"]=b(require("underscore"),require("mosaic-commons"),require("react")):a["mosaic-scroller"]=b(a.underscore,a["mosaic-commons"],a.react)}(this,function(a,b,c){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a.exports={Scroller:c(1),ScrollerView:c(2)}},function(a,b,c){var d=c(3),e=c(4);a.exports=e.Class.extend(e.Events.prototype,{initialize:function(a){this.setOptions(a),this._scrollPosition=0,this._scrollLength=0,this._placeholderLength=0},getPlaceholderLength:function(){return this._placeholderLength},getScrollLength:function(){return this._scrollLength},setScrollLength:function(a){this._scrollLength=a||1},getScrollPosition:function(){return this._scrollPosition},updateScrollPosition:function(a){var b=this;return b._handle(function(c){var d=b._getFullScrollerLen(c),e=a/d;return e=Math.max(0,Math.min(1,e)),b._updateScrollPosition(c,e,-1)})},scrollToItem:function(a){var b=this;return b._handle(function(c){a=a||0;var d=c?a/c:0;return d=Math.max(0,Math.min(1,d)),b._updateScrollPosition(c,d,a)})},_updateScrollPosition:function(a,b,c){var d=this,f=0,g=0,h=d._getFullScrollerLen(a),i=Math.round(h*b),j=d.getScrollLength();return e.P.then(function(){d._placeholderLength=h+j,d._scrollPosition=i;var e=Math.floor(b*a);e=Math.max(0,Math.min(a-1,e));var k=d._getBlockSize(a),l=Math.floor(e/k)*k,m=d._getAverageItemLength(),n=Math.ceil((e+j/m)/k)*k;g=l;var o=n-l;return f=(b*a-l)/o,d.options.renderItems({index:g,length:o,focused:c})}).then(function(b){var c=b.length,e=b.size,h=0;if(0==g&&e>=a&&j>c)d._placeholderLength=j,d._scrollPosition=0;else{var k=b.shift;(void 0===k||0>k)&&(k=f*c),h=Math.round(i-k)}return d.options.updateItemsPosition({index:g,position:h})})},_getFullScrollerLen:function(a){var b=0;if(a>0){var c=Math.ceil(Math.log(a)/Math.log(10)),d=this._getAverageItemLength();b=d*Math.pow(10,c)}return b},_getBlockSize:function(){return this.options.blockSize||5},_getAverageItemLength:function(){return this._itemLen||this.options.itemLen||10},_setAverageItemLength:function(a){this._itemLen=a||10},_handle:function(a){var b=this;return b._handling||(b._handling=e.P.then(function(){var a=b.options.getItemsNumber;return d.isFunction(a)&&(a=a()),a}).then(a).then(function(a){return delete b._handling,a},function(a){throw delete b._handling,a})),b._handling}})},function(a,b,c){var d=c(3),e=c(5),f=c(1),g=c(4);a.exports=e.createClass({getInitialState:function(){var a=this;return this.manager=new f({getItemsNumber:this.props.getItemsNumber,renderItems:function(b){return g.P.then(function(){return a.props.renderItems(b)}).then(function(c){var e=g.P.defer();b.deferred=e;var f=(b.index,b.length,d.extend({},b,{items:c,deferred:e}));return a.setState(a._newState(f)),e.promise})},updateItemsPosition:function(b){var c=a.refs.items,d=c.getDOMNode(),e=b.position;d.style.top=e+"px"}}),this._newState({items:[],index:0,length:0,deferred:void 0})},componentDidMount:function(){this._finishRendering()},componentDidUpdate:function(){this._finishRendering()},render:function(){var a=this.state.items,b=this.manager.getPlaceholderLength(),c=d.extend({},this.props.style,{overflowY:"auto",overflowX:"hidden"});return e.DOM.div({id:this.props.id,className:this.props.className,style:c,onScroll:this._onScroll},e.DOM.div({style:{position:"relative",height:b+"px"}},e.DOM.div({ref:"items",style:{position:"absolute",left:"0px",right:"0px",bottom:"auto"}},a)))},_newState:function(a){return d.extend({},this.state,a)},_onScroll:function(){var a=this.getDOMNode(),b=a.scrollTop;this.manager.updateScrollPosition(b)},_finishRendering:function(){var a=this.getDOMNode(),b=a.offsetHeight;this.manager.setScrollLength(b);var c=this.state.deferred;if(c){var d=this.refs.items,e=d.getDOMNode(),f=e.offsetHeight,g=-1,h=this.state.index,i=this.state.focused;if(i>=0){var j=e.firstChild;g=-1;for(var k=h;j&&i>k;k++){var l=j.offsetHeight;0>g?g=l:g+=l,j=j.nextSibling}}var m={length:f,size:this.state.items.length,shift:g},n=this.manager.getScrollPosition();a.scrollTop=n,c.resolve(m)}var h=this.props.index||0;this.manager.scrollToItem(h)}})},function(b){b.exports=a},function(a){a.exports=b},function(a){a.exports=c}])});