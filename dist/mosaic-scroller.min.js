/* 
 * mosaic-scroller v0.0.4 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("underscore"),require("mosaic-commons"),require("react")):"function"==typeof define&&define.amd?define(["underscore","mosaic-commons","react"],b):"object"==typeof exports?exports["mosaic-scroller"]=b(require("underscore"),require("mosaic-commons"),require("react")):a["mosaic-scroller"]=b(a.underscore,a["mosaic-commons"],a.react)}(this,function(a,b,c){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a.exports={ItemsList:c(1),Range:c(2),Scroller:c(3),ScrollerView:c(4)}},function(a,b,c){var d=c(5),e=(c(6),c(2));a.exports=e.extend({getLength:function(){var a=0,b=this.getItems();return d.each(b,function(b){a+=b.getLength()}),a},getItemsNumber:function(){var a=this.getItems();return a.length},getItems:function(){return this._get("itms")||[]},getStartIndex:function(){return this._get("idx")||0},getEndIndex:function(){var a=this.getStartIndex(),b=this.getItems();return a+b.length},setItems:function(a){return this._set("itms",a||[])}})},function(a,b,c){var d=c(5),e=c(6);a.exports=e.Class.extend(e.Events.prototype,{initialize:function(a){this.setOptions(a)},_setAll:function(a){var b=!1;return d.each(a,function(a,c){b|=!this._equal(a,this.options[c]),this.options[c]=a},this),this._notify(b)},_set:function(a,b){var c=!this._equal(b,this.options[a]);return this.options[a]=b,this._notify(c)},_get:function(a){return this.options[a]},_equal:function(a,b){return a==b},_notify:function(a){return a&&this.fire("updated"),a},setLength:function(a){return this._set("len",a||0)},getLength:function(){return this._get("len")},setPosition:function(a){return this._set("pos",a||0)},getPosition:function(){return this._get("pos")},setPositionAndLength:function(a,b){return this._setAll({pos:a,len:b})}})},function(a,b,c){var d=c(5),e=c(6),f=c(2),g=c(1);a.exports=e.Class.extend(e.Events.prototype,{initialize:function(a){this.setOptions(a),this.list=new g(a),this.scroll=new f(a),this.placeholder=new f(a)},getLength:function(){return this.placeholder.getLength()},setScroll:function(a,b){var c=this;return c._handle(function(d){var e=c._getFullScrollerLen(d),f=a/e;return f=Math.max(0,Math.min(1,f)),c._updateScrollPosition(d,f,b)})},focusItem:function(a,b){var c=this;return c._handle(function(d){a=a||0;var e=d?a/d:0;return e=Math.max(0,Math.min(1,e)),c._updateScrollPosition(d,e,b)})},_updateScrollPosition:function(a,b,c){var d=this,f=0,g=0,h=d._getFullScrollerLen(a),i=Math.round(h*b);return e.P.then(function(){d.placeholder.setLength(h+c),d.scroll.setPositionAndLength(i,c);var e=Math.floor(b*a);e=Math.max(0,Math.min(a-1,e));var j=d._getBlockSize(a),k=Math.floor(e/j)*j,l=d._getAverageItemLength(),m=Math.ceil((e+c/l)/j)*j;g=k;var n=m-k;return f=(b*a-k)/n,d._loadItems(g,n)}).then(function(b){d.list.setItems(b);var e,h=d.list.getLength();if(0==g&&b.length>=a&&c>h)d.placeholder.setLength(c),d.scroll.setPositionAndLength(0,c),e=d.list.setPositionAndLength(0,0);else{var j=f*h,k=Math.round(i-j);e=d.list.setPositionAndLength(k,g)}e&&d.fire("updated")})},_getFullScrollerLen:function(a){var b=0;if(a>0){var c=Math.ceil(Math.log(a)/Math.log(10)),d=this._getAverageItemLength();b=d*Math.pow(10,c)}return b},_getBlockSize:function(){return this.options.blockSize||5},_getAverageItemLength:function(){return this._itemLen||this.options.itemLen||10},_setAverageItemLength:function(a){this._itemLen=a||10},_handle:function(a){var b=this;return e.P.then(function(){return b._handling?void 0:(b._handling=!0,b._load("__loadlength",function(){var a=b.options.getItemsNumber;return d.isFunction(a)&&(a=a()),a}).then(a).then(function(a){return b._handling=!1,a},function(a){throw b._handling=!1,a}))})},_loadItems:function(a,b){return this._load("__loadItems",function(){return this.options.loadItems({index:a,length:b})})},_load:function(a,b){var c=this;c[a]&&c[a].reject("Interrupted");var d=c[a]=e.P.defer();return e.P.then(function(){return b.apply(c)}).then(d.resolve,d.reject),d.promise.then(function(b){return delete c[a],b},function(b){throw delete c[a],b})}})},function(a,b,c){var d=c(5),e=c(7),f=c(3);a.exports=e.createClass({getInitialState:function(){return this.manager=new f(this.props),this.manager.on("updated",this._onUpdate,this),this._newState()},componentDidMount:function(){this._updateScrollPos()},componentDidUpdate:function(){this._updateScrollPos()},render:function(){var a=this.manager.scroll,b=this.manager.list,c=(a.getPosition(),a.getLength(),b.getPosition(),b.getLength(),this._renderItems()),f=this.manager.placeholder,g=d.extend({},this.props.style,{overflowY:"auto",overflowX:"hidden"});return e.DOM.div({id:this.props.id,className:this.props.className,style:g,onScroll:this._onScroll},e.DOM.div({style:{position:"relative",height:f.getLength()+"px"}},e.DOM.div({style:{position:"absolute",height:b.getLength()+"px",top:b.getPosition()+"px",left:"0px",right:"0px",bottom:"auto"}},c)))},_onUpdate:function(){this.setState(this._newState())},_newState:function(a){return d.extend({},this.state,a)},_renderItems:function(){var a=this.manager.list,b=a.getItems();return this.props.renderItems({items:b,index:a.getStartIndex(),position:a.getPosition(),length:a.getLength()})},_onScroll:function(){var a=this.getDOMNode(),b=a.scrollTop,c=a.offsetHeight;this.manager.setScroll(b,c)},_updateScrollPos:function(){var a=this.getDOMNode(),b=a.offsetHeight,c=this.props.index||0;this.manager.focusItem(c,b)}})},function(b){b.exports=a},function(a){a.exports=b},function(a){a.exports=c}])});