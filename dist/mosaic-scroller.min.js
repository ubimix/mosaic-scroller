/* 
 * mosaic-scroller v0.0.9 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("underscore"),require("mosaic-commons"),require("react")):"function"==typeof define&&define.amd?define(["underscore","mosaic-commons","react"],b):"object"==typeof exports?exports["mosaic-scroller"]=b(require("underscore"),require("mosaic-commons"),require("react")):a["mosaic-scroller"]=b(a.underscore,a["mosaic-commons"],a.react)}(this,function(a,b,c){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a.exports={Scroller:c(1),ScrollerBlock:c(2),ScrollerView:c(3)}},function(a,b,c){var d=c(4),e=c(5);a.exports=e.Class.extend(e.Events.prototype,{initialize:function(a){this.setOptions(a),this._firstItemIndex=0,this._firstItemShift=0,this._block=null,this._blockShift=0},focusItem:function(a,b){var c=this;return e.P.then(function(){var d=c.getItemsNumber();return c._firstItemIndex=Math.max(0,Math.min(a,d-1)),c._firstItemShift=b||0,0===c._firstItemIndex&&(c._firstItemShift=Math.min(0,c._firstItemShift)),c._loadItems()})},setDelta:function(a){var b=this;return e.P.then(function(){var c=b.getAverageItemLength();if(!b._block){var d=Math.floor(Math.max(0,a)/c),e=-Math.abs(a)%c;return b.focusItem(d,e)}for(var d=b._block.getIndex(),f=b._block.getSize(),e=b._blockShift+a,g=d,h=0;0>e&&f>h;h++){var i=b._block.getItemLength(h);e+=i,g++}return b.focusItem(g,e)})},getBlock:function(){return this._block},getBlockShift:function(){return this._blockShift},getBlockSize:function(){return this._getOptionValue("blockSize")||5},getItemsNumber:function(){return this._getOptionValue("itemsNumber")||0},getAverageItemLength:function(){return this._getOptionValue("itemLen")||10},getScrollerLength:function(){return this._getOptionValue("scrollerLen")||0},getFirstItemShift:function(){return this._firstItemShift},getFirstItemIndex:function(){return this._firstItemIndex},addChangeListener:function(a,b){this.on("update",a,b)},removeChangeListener:function(a,b){this.off("update",a,b)},_loadItems:function(){var a=this;return e.P.then(function(){var b=a.getBlockSize(),c=a.getAverageItemLength(),d=a.getScrollerLength(),e=a.getItemsNumber(),f=a._firstItemIndex;f=Math.max(0,Math.min(f,e-1));var g=Math.ceil(2*d/c),h=Math.ceil(Math.abs(a._firstItemShift)/c);return a._firstItemShift>=0?f-=h:g+=h,f=Math.floor(Math.max(0,f)/b)*b,g=Math.ceil(g/b)*b,g=Math.max(0,Math.min(g,e-f)),a.options.loadItems({index:f,length:g})}).then(function(b){a._block=b;for(var c=a._block.getIndex(),d=0,e=c;e<a._firstItemIndex;e++){var f=a._block.getItemLength(e-c);d+=f}var g=a._block.getSize(),h=a.getItemsNumber();if(c+g===h){for(var i=0,e=a._firstItemIndex;h>e;e++){var f=a._block.getItemLength(e-c);i+=f}var j=a.getScrollerLength();a._firstItemShift=Math.max(a._firstItemShift,j-i)}0===a._firstItemIndex&&(a._firstItemShift=Math.min(0,a._firstItemShift)),a._blockShift=a._firstItemShift-d,0===c&&(a._blockShift=Math.min(0,a._blockShift),a._firstItemShift=Math.min(a._blockShift+d,a._firstItemShift)),a.emit("update",a)})},_getOptionValue:function(a){var b=this.options[a];return d.isFunction(b)&&(b=b()),b}})},function(a,b,c){var d=c(4),e=c(5);a.exports=e.Class.extend({initialize:function(a){d.extend(this,a)},getIndex:function(){return this.index},getSize:function(){return this.items.length},getItemLength:function(a){var b=this.items.length;if(0>a||a>=b)return 0;var c=this.items[a];return c.offsetHeight}})},function(a,b,c){var d=c(4),e=c(6),f=c(5),g=c(7),h=c(2),i=c(1),j={addResizeListener:function(a){window.attachEvent?window.attachEvent("onresize",a):window.addEventListener&&window.addEventListener("resize",a,!0)},removeResizeListener:function(a){window.detachEvent?window.detachEvent("onresize",a):window.removeEventListener&&window.removeEventListener("resize",a,!0)}};a.exports=e.createClass({mixins:[j],componentWillMount:function(){var a=this;a._renderParams={index:0,length:0,items:[]},this._updatePosition=!0,a.addResizeListener(a._onResize),a._tracker=new g,a._scroller=new i(d.extend({itemLen:10,blockSize:10,scrollerLen:function(){if(!a.isMounted())return 10;var b=a.getDOMNode(),c=b.offsetHeight;return c}},a.props,{itemsNumber:function(){return a.props.getItemsNumber()},loadItems:function(b){return a._startItemsRendering(b)}})),a._scroller.addChangeListener(function(){if(a.isMounted()){var b=a.refs.items.getDOMNode(),c=a._scroller.getBlockShift();b.style.marginTop=c+"px"}}),a._tracker.addChangeListener(function(b){if(a.isMounted()){var c=a.refs.scroller.getDOMNode();b.position!=c.scrollTop&&(c.scrollTop=b.position);var d=a.refs.items.getDOMNode();d.style.top=b.position+"px",a._scroller.setDelta(-b.delta)}},a)},componentWillUnmount:function(){this.removeResizeListener(this._onResize)},componentDidMount:function(){var a=this;a._scroller.setDelta(0),setTimeout(function(){a._updateScroller()},1)},componentWillReceiveProps:function(){this._updatePosition=!0},componentDidUpdate:function(){this._updatePosition&&(this._updatePosition=!1,this._scroller.focusItem(this.props.index||0)),this._finishItemsRendering()},_onResize:function(){this._updateScroller(),this._scroller.setDelta(0)},_onScroll:function(){this._updateScroller()},getInitialState:function(){return{}},_updateScroller:function(){var a=this.getDOMNode(),b=this.refs.scroller.getDOMNode();this._tracker.setPosition(b.scrollTop),b.style.height=a.offsetHeight+"px";var c=this._tracker.getLength(),d=this.refs.placeholder.getDOMNode();d.style.height=c+"px"},_startItemsRendering:function(a){var b=this;return b._renderParams=d.extend(b._renderParams,a),f.P.then(function(){return b.props.renderItems(b._renderParams)}).then(function(a){return b._renderParams.items=a,b._deferredRendering||(b._deferredRendering=f.P.defer(),b._deferredRendering.promise.then(function(){delete b._deferredRendering}),b._updateState()),b._deferredRendering.promise})},_updateState:function(){this.setState({})},_getScrollerWidth:function(){if(void 0===this._scrollerWidth){{var a=this.refs.scroller.getDOMNode();this.refs.placeholder.getDOMNode()}a.style.overflowY="scroller";var b=a.clientWidth,c=a.offsetWidth;this._scrollerWidth=c-b||0}return this._scrollerWidth},_finishItemsRendering:function(){var a=this,b=a.getDOMNode(),c=a._getScrollerWidth(),d=a.refs.scroller.getDOMNode();if(d.style.height=b.offsetHeight+"px",d.style.marginRight="-"+c+"px",a._deferredRendering){var e=a.refs.items.getDOMNode(),f=e.childNodes,g=new h({getIndex:function(){return a._renderParams.index},getSize:function(){return f.length},getItemLength:function(a){var b=f.length;if(0>a||a>=b)return 0;var c=f[a];return c.offsetHeight}});a._deferredRendering.resolve(g),a._updateScrollbarPosition()}},_updateScrollbarPosition:function(){var a=this,b=a._scroller.getItemsNumber(),c=a._scroller.getFirstItemIndex(),d=b?c/b:0,e=a.refs.scrollbar.getDOMNode(),f=a.refs.slider.getDOMNode(),g=f.offsetHeight,h=e.offsetHeight,i=Math.round((h-g)*d);f.style.top=i+"px"},render:function(){var a=this,b=a._renderParams.items,c=d.extend({},a.props.style,{overflow:"hidden"}),f=a._tracker.getLength();return e.DOM.div({id:a.props.id,className:a.props.className,style:c,onScroll:a._onScroll},e.DOM.div({key:"wrapper",className:"wrapper",style:{position:"absolute",top:0,bottom:0,left:0,right:0,margin:0,padding:0}},e.DOM.div({key:"scroller",ref:"scroller",style:{overflowY:"scroll",overflowX:"hidden",position:"relative",margin:0,padding:0}},e.DOM.div({key:"placeholder",ref:"placeholder",style:{position:"relative",height:f+"px",overflow:"hidden",paddingRight:"3px",margin:0,padding:0}},e.DOM.div({ref:"items",style:{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"auto",margin:0,padding:0}},b))),e.DOM.div({key:"scrollbar",ref:"scrollbar",className:"scrollbar",style:{position:"absolute",top:0,bottom:0,right:0,margin:0,padding:0,maxWidth:"10px"}},e.DOM.div({key:"slider",ref:"slider",className:"slider",style:{position:"absolute",top:0,bottom:0,right:0,margin:"3px",padding:0,minHeight:"10px",minWidth:"3px"}}))))}})},function(b){b.exports=a},function(a){a.exports=b},function(a){a.exports=c},function(a,b,c){var d=(c(4),c(5));a.exports=d.Class.extend(d.Events.prototype,{initialize:function(a){this.setOptions(a),this._position=-1,this._delta=0},getLength:function(){return this.options.length||1e5},getPosition:function(){return this._position},getDelta:function(){return this._delta},setPosition:function(a){var b=this._position||0;this._position=a||0;var c=this.getLength(),d=this.getThreshold(),e=0;this._position<d||this._position>c-d?this._position=c/2:e=this._position-b,this._delta=e,this.emit("update",{prevPosition:b,position:this._position,delta:e})},getThreshold:function(){if(!this.options.threshold){var a=this.getLength();this.options.threshold=Math.max(a/4,50)}return this.options.threshold},addChangeListener:function(a,b){this.on("update",a,b)},removeChangeListener:function(a,b){this.off("update",a,b)}})}])});